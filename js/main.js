!function(){"use strict";var e=angular.module("snApp",["ngRoute","ngStorage","ngAnimate","snServices","ngCookies","ngSanitize","angular-md5","angular-loading-bar"]);e.config(["$locationProvider","$routeProvider","$httpProvider",function(e,t,o){e.hashPrefix("!"),t.when("/signin",{templateUrl:"./partials/user/signin.html",controller:"UserController"}).when("/signup",{templateUrl:"./partials/user/signup.html",controller:"UserController"}).when("/users",{templateUrl:"./partials/user/gallery.html",controller:"UserController",page_mode:"user_list"}).when("/user/:pk",{templateUrl:"./partials/user/view.html",controller:"UserController",page_mode:"user_page"}).when("/me",{templateUrl:"./partials/user/view_me.html",controller:"UserController",page_mode:"me_page"}).when("/topics",{templateUrl:"./partials/topic/list.html",controller:"TopicController",page_mode:"topic_list"}).when("/topics/:page",{templateUrl:"./partials/topic/list.html",controller:"TopicController",page_mode:"topic_list"}).when("/topic/:pk",{templateUrl:"./partials/topic/view.html",controller:"TopicController",page_mode:"topic_page"}).otherwise({redirectTo:"/topics"}),o.interceptors.push(["$q","$location","$localStorage",function(e,t,o){return{request:function(e){return e.headers=e.headers||{},o.user!=={}&&void 0!==o.user&&(e.headers.Authorization="Token "+o.user.token),e},responseError:function(o){return(401===o.status||403===o.status)&&t.path("/signin"),e.reject(o)}}}]),o.defaults.headers.common["Content-Type"]="application/json",o.defaults.xsrfCookieName="csrftoken",o.defaults.xsrfHeaderName="X-CSRFToken"}]).controller("MainController",["$scope","$localStorage","User",function(e,t,o){e.user=o.getCurrentUser(),e.logout=function(){o.logout(function(){window.location="/"},function(){alert("Failed to logout!")})}}]).controller("UserController",["$rootScope","$scope","$route","$location","$localStorage","$http","$routeParams","User","Topic",function(e,t,o,r,n,i,a,l,s){t.user=n.user,t.signin=function(){var o={username:t.username,password:t.password};l.signin(o,function(e){n.user=e,window.location="/"},function(t){e.error="Failed to signin",void 0===t.type&&console.log(t)})},t.signup=function(){var o={username:t.username,email:t.email,password:t.password};l.save(o,function(t){console.log(t.status),201!=t.status?alert(t.data):l.signin(o,function(e){n.user=e,window.location="/"},function(t){e.error="Failed to signin",void 0===t.type&&console.log(t)})},function(t){console.log(t.status),e.error="Failed to signup"})},t.me=function(){l.me(function(e){t.myDetails=e},function(){e.error="Failed to fetch details"})},t.logout=function(){l.logout(function(){window.location="/"},function(){alert("Failed to logout!")})},"user_list"==o.current.$$route.page_mode&&l.query(function(e){t.users=e},function(){console.log("error")}),"user_page"==o.current.$$route.page_mode&&(t.getUserInfo=function(){var e={};return e=l.queryUser(a.pk,function(e){return e.data},function(){return{}}).$$state},l.queryUserTopics(a.pk,1,function(e){t.topics=e.data},function(e){alert("Error")})),"me_page"==o.current.$$route.page_mode&&(t.getUserInfo=function(){var e={};return e=l.queryUser(t.user.id,function(e){return e.data},function(){return{}}).$$state},l.queryUserTopics(t.user.id,1,function(e){t.topics=e.data},function(e){alert("Error"),window.location="/"}))}]).controller("TopicController",["$scope","$sanitize","$localStorage","$route","$routeParams","User","Topic",function(e,t,o,r,n,i,a){e.getUserInfo=function(e){var t={};return t=i.queryUser(e,function(e){return e.data},function(){return{}}).$$state},"undefined"!=typeof n.page,"topic_list"==r.current.$$route.page_mode&&(e.list_page="undefined"!=typeof n.page?1:n.page,a.query(e.list_page,function(t){e.topics=t.data},function(e){alert("Error")})),"topic_page"==r.current.$$route.page_mode&&(e.page="undefined"!=typeof n.page?1:n.page,a.view(n.pk,function(t){e.t=t.data,a.getReplies(n.pk,e.page,function(t){e.replies=t.data},function(){})},function(){})),"topic_list_a_la_tag"==r.current.$$route.page_mode}])}();